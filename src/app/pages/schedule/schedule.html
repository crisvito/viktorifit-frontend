<div class="font-poppins px-5 min-[568px]:px-10 md:px-0 md:pr-4 pb-20 w-full relative">

    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 mt-6 md:mb-9 md:mt-9 gap-4">
        <h2 class="text-[28px] font-bold">Schedule</h2>
    </div>

    <div class="flex items-center gap-3 z-20 self-end md:self-auto mt-5 md:mt-0">
        <span class="text-gray-600 font-medium text-[16px]">Mode : </span>
        
        <div class="relative">
            <button (click)="toggleMode()" 
                    class="flex items-center gap-2 bg-black px-6.5 py-1.5 rounded-2xl font-medium hover:brightness-95 transition text-white relative z-30 min-w-25 justify-between cursor-pointer">
                <span>{{ selectedMode }}</span>
                <img src="/assets/calendar/dropdown.svg" alt=""
                        class="w-3 h-3 transition-transform duration-200"
                        [class.rotate-180]="isModeOpen">
            </button>

            <div *ngIf="isModeOpen" (click)="toggleMode()" class="fixed inset-0 z-20 bg-transparent cursor-default"></div>

            <div *ngIf="isModeOpen" class="absolute top-full right-0 mt-2 w-full z-30 animate-in fade-in zoom-in-95 duration-100">
                <div class="bg-gray-100 rounded-xl shadow-xl border border-gray-200 overflow-hidden">
                    <div (click)="setMode('Home')" 
                            class="px-4 py-2 text-center font-bold cursor-pointer transition border-b border-gray-200 text-[16px] hover:bg-gray-200"
                            [class.bg-white]="selectedMode === 'Home'" 
                            [class.text-black]="selectedMode === 'Home'" 
                            [class.text-gray-500]="selectedMode !== 'Home'">
                        Home
                    </div>
                    <div (click)="setMode('Gym')" 
                            class="px-4 py-2 text-center font-bold cursor-pointer transition hover:bg-gray-200"
                            [class.bg-white]="selectedMode === 'Gym'" 
                            [class.text-black]="selectedMode === 'Gym'" 
                            [class.text-gray-500]="selectedMode !== 'Gym'">
                        Gym
                    </div>
                </div>
            </div>
        </div> 
    </div>

    <div class="grid grid-cols-1 mt-5 lg:grid-cols-3 gap-4">

        <div class="lg:col-span-2 space-y-8">
            
            <div class="bg-black text-white rounded-[7.52px] p-8 md:p-10 flex flex-col justify-center min-h-34.25">
                <h3 class="text-[32px] font-bold leading-tight mb-2">You're Doing {{ selectedMode }} Workout</h3>
                <p class="text-gray-400 text-[14px]">Here are workouts that you could do at {{ selectedMode.toLowerCase() }}</p>
            </div>

            <div>
                <div class="flex items-center gap-3 justify-between">
                    <h3 class="text-[28px] font-bold">Activity List</h3>
                </div>
                
                <div class="flex flex-row justify-between items-center mt-5">
                    <p class="text-gray-500 font-medium text-[20px]">{{ currentDate | date:'EEE, dd MMM yyyy' }}</p>
                    <button routerLink="/history" class="text-white rounded-3xl border-[1.25px] border-gray-500 hover:bg-[#AFFA01] flex flex-row p-1.5 px-6 gap-3 text-[16px] items-center hover:text-black transition duration-300">
                        <img src="/assets/calendar/activity-list.svg" alt="" class="w-5 h-5">
                        <h3 class="text-gray-500">History</h3>
                    </button>
                </div>
            </div>

            <div class="flex flex-col gap-5 -mt-5">
                
                <div *ngFor="let item of activities; let i = index" class="bg-[#F2F2F2] rounded-lg border border-[#D2D2D2] overflow-hidden transition-all duration-300">
                    
                    <div class="p-6">
                        <div class="flex flex-col md:flex-row gap-6 mb-2">
                            <div class="w-24 h-24 bg-[#BCE455] rounded-xl flex items-center justify-center shrink-0">
                                <img src="/assets/icons/running-man.svg" alt="icon" class="w-12 h-12 text-black"> 
                            </div>

                            <div class="flex-1 flex flex-col">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="text-[16px] font-medium">{{ item.title }}</h4>
                                        <p class="text-[11px] text-gray-500 mt-1 leading-relaxed max-w-md">{{ item.description }}</p>
                                    </div>
                                    <div class="flex flex-col gap-2 shrink-0 ml-4 mt-4 md:mt-0">
                                        <div class="flex items-center gap-2 text-[11px] text-[#5C8C00] font-medium">
                                            <div class="w-5 h-5 bg-[#6A9700] flex items-center justify-center rounded-sm">
                                                <img src="/assets/calendar/duration.svg" alt="" class="w-3 h-3">
                                            </div>
                                            {{ item.time }}
                                        </div>
                                        <div class="flex items-center gap-2 text-[11px] text-[#E10000] font-medium">
                                            <div class="w-5 h-5 bg-[#E10000] flex items-center justify-center rounded-sm">
                                                <img src="/assets/calendar/calories.svg" alt="" class="w-3 h-3">
                                            </div>
                                            {{ item.calories }}
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-5.5">
                                    <div class="inline-flex items-center gap-1 bg-[#AFFA01] text-[#404040] text-[11px] font-medium px-3 py-1 rounded-[18.58px]">
                                        <img src="/assets/workout-lists/workout-run.svg" alt="">{{ item.tag }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex flex-col md:flex-row items-end justify-between gap-4 md:gap-6 mt-4">
                            <div class="w-full md:w-[55%]">
                                <div class="flex items-center justify-between text-[11px] text-[#6D6D6D] mb-1.5">
                                    <span>Progress :</span>
                                    <span>{{ item.progress }}%</span>
                                </div>
                                <div class="w-full bg-[#E5E5E5] h-2.5 rounded-full overflow-hidden">
                                    <div class="bg-[#AFFA01] h-full rounded-full transition-all duration-500" [style.width.%]="item.progress"></div>
                                </div>
                            </div>

                            <button (click)="openLogModal(i)" 
                                    class="w-full md:w-[38%] py-0.75 bg-[#AFFA01] border border-[#8AC500] hover:bg-[#9ed801] text-[#4E7000] font-medium rounded-[18px] text-[14px] transition flex items-center justify-center gap-2 cursor-pointer shadow-sm whitespace-nowrap">
                                <span class="text-lg font-light">+</span> Add New Log
                            </button>
                        </div>
                    </div>

                    <div class="bg-[#EDEDED] border-t border-[#D2D2D2]">
                        
                        <div *ngIf="item.expanded" class="px-6 py-6 animate-in slide-in-from-top-2 duration-200">
                            
                            <div *ngIf="!item.logs || item.logs.length === 0" class="text-center py-2">
                                <p class="text-[#A0A0A0] text-[14px] italic font-light">Your Log is Empty! Start Workout Now!</p>
                            </div>

                            <div *ngIf="item.logs && item.logs.length > 0" class="space-y-4">
                                <div *ngFor="let log of item.logs" class="flex gap-3 items-stretch">
                                    <div class="w-1.5 bg-[#6A9700] rounded-full shrink-0"></div>
                                    <div class="flex-1 bg-[#DBF3A3] border border-[#AFFA01] p-4 rounded-lg shadow-sm flex justify-between items-start">
                                        <div>
                                            <h5 class="text-[14px] font-bold text-[#1F1F1F]">{{ log.name }}</h5>
                                            <p class="text-[12px] text-[#404040] mt-1 leading-relaxed">{{ log.description }}</p>
                                        </div>
                                        <div class="flex items-center gap-2 text-right shrink-0 ml-4">
                                            <div class="w-5 h-5 bg-[#6A9700] rounded-sm flex items-center justify-center">
                                                <img src="/assets/calendar/duration.svg" alt="" class="w-3 h-3">
                                            </div>
                                            <span class="text-[11px] font-medium text-[#4A6418]">
                                                {{ log.duration }}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div *ngIf="item.expanded" class="h-px bg-[#D2D2D2] mx-6"></div>

                        <button (click)="item.expanded = !item.expanded" 
                                class="w-full flex items-center justify-center gap-2 text-gray-400 text-[13px] font-medium py-3 transition group cursor-pointer">
                            <img src="/assets/calendar/arrow-down.svg" alt="" class="transition-transform duration-300" [class.rotate-180]="item.expanded">
                            {{ item.expanded ? 'Close All Log' : 'View All Log' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <app-calendar [selectedMode]="selectedMode"></app-calendar>
        </div>

    </div>
</div>

<div *ngIf="isLogModalOpen" class="fixed inset-0 z-[9999] flex items-center justify-center px-4">
    
    <div (click)="closeLogModal()" class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity"></div>
    
    <div class="bg-[#F4F4F4] w-full max-w-125 rounded-xl border border-[#D2D2D2] p-6 md:p-8 relative z-50 shadow-2xl animate-in fade-in zoom-in-95 duration-200">
        
        <button (click)="closeLogModal()" class="absolute top-6 right-6 w-8 h-8 rounded-full bg-[#E5E5E5] flex items-center justify-center hover:bg-[#d4d4d4] transition cursor-pointer">
            <img src="assets/calendar/cross.svg" alt="cross" class="w-4 h-4">
        </button>

        <div class="flex items-center gap-3 mb-6">
            <span class="text-[24px] font-light text-[#4A6418]">+</span>
            <h3 class="text-[20px] font-bold text-[#2A3906]">Add New Log</h3>
        </div>
        
        <hr class="border-[#D2D2D2] mb-6">

        <form (ngSubmit)="saveNewLog()" class="space-y-5">
            
            <div class="space-y-2">
                <label class="text-[14px] font-medium text-black">Name Of Your Log</label>
                <input type="text" [(ngModel)]="logForm.name" name="name" required
                        class="w-full h-12 px-4 rounded-lg border border-gray-200 bg-white focus:outline-none focus:border-[#AFFA01] text-[14px] placeholder-gray-400"
                        placeholder="Log 1">
            </div>

            <div class="space-y-2">
                <label class="text-[14px] font-medium text-black">Log Description</label>
                <textarea [(ngModel)]="logForm.description" name="description" rows="4" required
                            class="w-full p-4 rounded-lg border border-gray-200 bg-white focus:outline-none focus:border-[#AFFA01] text-[14px] resize-none placeholder-gray-400"
                            placeholder="Describe your workout..."></textarea>
                <div class="text-right text-[12px] text-gray-400">
                    {{ logForm.description.length }} / 100 words
                </div>
            </div>

            <div class="space-y-2">
                <label class="text-[14px] font-medium text-black">Log Duration</label>
                <input type="text" [(ngModel)]="logForm.duration" name="duration" required
                        class="w-full h-12 px-4 rounded-lg border border-gray-200 bg-white focus:outline-none focus:border-[#AFFA01] text-[14px] placeholder-gray-400"
                        placeholder="e.g. 30">
            </div>

            <div class="pt-4">
                <button type="submit" class="w-full h-12 bg-[#AFFA01] hover:bg-[#9ed801] text-black font-semibold rounded-[6.72px] shadow-sm transition transform active:scale-[0.98] cursor-pointer">
                    Save New Log
                </button>
            </div>

        </form>

    </div>
</div>
<div class="font-poppins px-5 min-[568px]:px-10 md:px-0 md:pr-4 pb-20 w-full relative">
  <div
    class="relative bg-black rounded-[10px] p-6 sm:p-8 md:p-10 mb-5 overflow-hidden min-h-40 flex items-center"
  >
    <div class="relative z-10 w-full md:max-w-[60%]">
      <h3 class="text-[20px] sm:text-[24px] md:text-[32px] font-bold text-white leading-tight mb-2">
        Your Overall Statistic Seems <span class="text-[#AFFA01]">Nice!</span>
      </h3>
      <p class="text-gray-400 text-[11px] md:text-[14px]">
        There are your workouts data in 7 weeks, keep it up!
      </p>
    </div>

    <div class="absolute top-0 right-0 h-full w-[40%] pointer-events-none select-none">
      <img
        src="/pages/statistic/component-top.svg"
        alt=""
        class="absolute top-2 right-[140%] sm:right-[180%] w-[60%] sm:w-[70%] h-[70%] object-contain opacity-100 scale-125"
      />
      <img
        src="/pages/statistic/component-bottom.svg"
        alt=""
        class="absolute top-11 right-[15%] sm:right-[20%] w-[70%] sm:w-[80%] h-[80%] object-contain opacity-100"
      />

      <img
        src="/pages/statistic/emoticon.svg"
        alt="Smile"
        class="absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 h-[80%] md:h-full w-auto object-contain translate-x-2 sm:translate-x-4 z-10 hidden md:block"
      />
    </div>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
    <div
      *ngFor="let card of statCards"
      [class]="
        'rounded-md p-5 border relative overflow-hidden transition ' +
        (selectedStat === card.id
          ? 'bg-[#E7F4C8] border-[#C3F74A]'
          : 'bg-[#F4F4F4] border-[#D2D2D2]')
      "
    >
      <div class="flex justify-between items-start mb-4 gap-2">
        <div
          class="flex items-center gap-2 text-[#525252] text-[14px] md:text-[16px] font-medium shrink-0"
        >
          <img [src]="card.icon" alt="" class="w-4 h-4 opacity-60" /> {{ card.title }}
        </div>

        <button
          (click)="selectStat(card.id)"
          [class]="
            selectedStat === card.id
              ? 'px-3 md:px-2 lg:px-4.5 py-1 bg-[#AFFA01] border border-[#AFFA01] text-[#4E7000] text-[10px] md:text-[10px] lg:text-[12px] font-bold rounded-[14px] cursor-default whitespace-nowrap'
              : 'px-3 md:px-2 lg:px-4.5 py-1 border border-gray-400 text-gray-500 text-[10px] md:text-[10px] lg:text-[12px] rounded-[14px] hover:bg-gray-200 transition cursor-pointer whitespace-nowrap'
          "
        >
          {{ selectedStat === card.id ? 'Currently Show' : 'Show Graphic' }}
        </button>
      </div>

      <div class="relative z-10">
        <h3 class="text-[28px] md:text-[32px] font-semibold text-[#1F1F1F]">{{ card.value }}</h3>
        <div class="flex items-center gap-2 mt-1">
          <span
            *ngIf="card.id === 'weights'"
            [class]="
              card.isPositive
                ? 'bg-[#C3F74A] text-[#4E7000] px-3 py-0.5 rounded-[15px] text-[10px] md:text-[11px] font-medium'
                : 'bg-[#FFB0A4] text-[#E10000] px-3 py-0.5 rounded-[15px] text-[10px] md:text-[11px] font-medium'
            "
          >
            {{ card.change }}
          </span>
          <span class="text-gray-400 text-[11px] md:text-[12px]">{{ card.changeText }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-4">
    <div
      class="lg:col-span-2 bg-[#F4F4F4] rounded-[11px] border border-[#D2D2D2] p-5 md:p-6 flex flex-col h-full overflow-hidden"
    >
      <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
        <h3 class="text-[20px] md:text-[24px] font-bold text-[#1F1F1F]">Statistic</h3>
        <div class="flex flex-wrap gap-4 md:gap-6">
          <div class="flex items-center gap-2">
            <div
              class="w-3 h-3 rounded-full transition-colors"
              [style.background-color]="currentTheme.color"
            ></div>
            <span class="text-[11px] md:text-[12px] text-gray-600 font-medium"
              >Your {{ getStatLabel() }}</span
            >
          </div>
        </div>
      </div>

      <div class="relative w-full grow min-h-75 md:min-h-100">
        <canvas
          baseChart
          [data]="lineChartData"
          [options]="lineChartOptions"
          [plugins]="lineChartPlugins"
          [type]="lineChartType"
        >
        </canvas>
      </div>
    </div>

    <div class="bg-[#F4F4F4] rounded-[11px] border border-[#D2D2D2] p-5 md:p-6 flex flex-col">
      <div class="mb-4">
        <h3 class="text-[20px] md:text-[24px] font-bold text-[#1F1F1F]">Top Activity</h3>
      </div>

      <div class="relative w-48 h-48 sm:w-55 sm:h-55 mx-auto my-6 shrink-0">
        <svg viewBox="0 0 100 100" class="w-full h-full transform -rotate-90">
          <defs>
            <linearGradient id="gradRed" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#FF3F3F" />
              <stop offset="100%" stop-color="#E88484" />
            </linearGradient>
            <linearGradient id="gradYellow" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#E8B900" />
              <stop offset="100%" stop-color="#FFF492" />
            </linearGradient>
            <linearGradient id="gradGreen" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#87C100" />
              <stop offset="100%" stop-color="#CEFF5C" />
            </linearGradient>
            <linearGradient id="gradBlue" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#3B82F6" />
              <stop offset="100%" stop-color="#93C5FD" />
            </linearGradient>
          </defs>
          <circle
            *ngFor="let item of topActivities; let i = index"
            cx="50"
            cy="50"
            r="40"
            fill="none"
            [attr.stroke]="item.chartColor"
            stroke-width="20"
            [attr.stroke-dasharray]="donutSegments[i]?.dashArray"
            [attr.stroke-dashoffset]="donutSegments[i]?.dashOffset"
            stroke-linecap="butt"
            class="transition-all duration-500"
          />
        </svg>

        <div class="absolute inset-0 flex flex-col items-center justify-center z-10">
          <span class="text-[28px] md:text-[36px] font-bold text-[#1F1F1F] leading-none">
            {{ statCards[0].value.replace(' mins', '') }}
          </span>
          <span class="text-[10px] md:text-[12px] text-gray-500 font-medium">Minutes</span>
        </div>
      </div>

      <div class="mt-auto pt-4 border-t border-gray-200">
        <h4 class="text-[14px] md:text-[16px] font-bold text-gray-400 mb-4">Activity Breakdown</h4>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-y-3 gap-x-2">
          <div *ngFor="let item of topActivities" class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full shrink-0" [style.background]="item.legendColor"></div>
            <span
              class="text-[12px] md:text-[14px] font-medium text-[#1F1F1F] truncate"
              [title]="item.name"
            >
              {{ item.name }} ({{ item.percent }})
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="isPeriodModalOpen" class="fixed inset-0 z-50 flex items-center justify-center px-4">
  <div
    class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity"
    (click)="closePeriodModal()"
  ></div>
  <div
    class="bg-[#F4F4F4] border-[0.75px] border-[#D2D2D2] rounded-[11.95px] w-full max-w-sm sm:max-w-md p-6 relative z-10 shadow-2xl animate-in zoom-in-95 duration-200"
  >
    <div class="flex justify-end">
      <button
        (click)="closePeriodModal()"
        class="w-8 h-8 rounded-full bg-[#D2D2D2] flex items-center justify-center hover:bg-[#E0E0E0] transition cursor-pointer"
      >
        <img src="/pages/history/cross.svg" alt="close" class="w-4 h-4" />
      </button>
    </div>
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-[18px] md:text-[20px] font-semibold text-[#2E4200]">Pick Periode</h3>
    </div>
    <div class="h-[1.12px] bg-[#D2D2D2] w-full mb-6"></div>

    <div class="flex justify-center gap-6 sm:gap-12 h-50 relative">
      <div
        id="monthContainer"
        (scroll)="onScrollMonth($event)"
        class="h-full overflow-y-auto scrollbar-hide text-center snap-y snap-mandatory z-10 w-24 sm:w-30"
      >
        <div class="h-20"></div>
        <div
          *ngFor="let m of monthsList; let i = index"
          class="h-10 flex items-center justify-center cursor-pointer transition-all duration-200 snap-center"
          (click)="tempMonthIndex = i; scrollToActive()"
          [class.text-[18px]]="i === tempMonthIndex"
          [class.md:text-[20px]]="i === tempMonthIndex"
          [class.font-bold]="i === tempMonthIndex"
          [class.text-black]="i === tempMonthIndex"
          [class.text-[#A0A0A0]]="i !== tempMonthIndex"
          [class.text-[14px]]="i !== tempMonthIndex"
          [class.md:text-[16px]]="i !== tempMonthIndex"
          [class.scale-110]="i === tempMonthIndex"
        >
          {{ m }}
        </div>
        <div class="h-20"></div>
      </div>

      <div
        id="yearContainer"
        (scroll)="onScrollYear($event)"
        class="h-full overflow-y-auto scrollbar-hide text-center snap-y snap-mandatory z-10 w-16 sm:w-20"
      >
        <div class="h-20"></div>
        <div
          *ngFor="let y of yearsList"
          class="h-10 flex items-center justify-center cursor-pointer transition-all duration-200 snap-center"
          (click)="tempYear = y; scrollToActive()"
          [class.text-[18px]]="y === tempYear"
          [class.md:text-[20px]]="y === tempYear"
          [class.font-bold]="y === tempYear"
          [class.text-black]="y === tempYear"
          [class.text-[#A0A0A0]]="y !== tempYear"
          [class.text-[14px]]="y !== tempYear"
          [class.md:text-[16px]]="y !== tempYear"
          [class.scale-110]="y === tempYear"
        >
          {{ y }}
        </div>
        <div class="h-20"></div>
      </div>

      <div
        class="absolute inset-0 pointer-events-none bg-linear-to-b from-[#F4F4F4] via-transparent to-[#F4F4F4] z-20"
      ></div>
    </div>

    <div class="mt-8">
      <button
        (click)="applyPeriodSelection()"
        class="w-full bg-[#AFFA01] hover:bg-[#9de300] text-black font-medium py-3 rounded-[6.72px] transition shadow-md active:scale-[0.98] cursor-pointer"
      >
        Search
      </button>
    </div>
  </div>
</div>

<div class="font-poppins px-5 min-[568px]:px-10 md:px-0 md:pr-4 pb-20 w-full relative">
  <div class="grid grid-cols-1 mt-5 lg:grid-cols-3 gap-4">
    <div class="lg:col-span-2">
      <div class="flex flex-wrap items-center justify-between mb-5">
        <div class="flex items-center gap-4">
          <h3 class="text-[28px] font-bold">History Activity</h3>
        </div>
        <button
          aria-label="cross"
          (click)="closeHistory()"
          class="w-10 h-10 rounded-full bg-[#EDEDED] flex items-center justify-center hover:bg-[#dcdcdc] transition cursor-pointer"
        >
          <img src="/pages/history/cross.svg" alt="" class="w-5 h-5" />
        </button>
      </div>

      <div class="mb-7">
        <button
          (click)="openPeriodModal()"
          class="flex items-center gap-2 px-6 py-1.5 rounded-full border border-[#808080] hover:bg-gray-50 transition text-[14px] font-medium text-[#565656] cursor-pointer"
        >
          {{ selectedMonth | date: 'MMM yyyy' }}

          <img
            src="/pages/history/arrow-down.svg"
            alt="arrow"
            class="w-3 h-3 transition-transform duration-200"
            [class.rotate-180]="isPeriodModalOpen"
          />
        </button>
      </div>

      <div
        *ngIf="isPeriodModalOpen"
        class="fixed inset-0 z-100 flex items-center justify-center px-4"
      >
        <div
          class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity"
          (click)="closePeriodModal()"
        ></div>

        <div
          class="bg-[#F4F4F4] border-[0.75px] border-[#D2D2D2] rounded-[11.95px] w-full max-w-md p-6 relative z-10 shadow-2xl animate-in zoom-in-95 duration-200"
        >
          <div class="flex justify-end">
            <button
              (click)="closePeriodModal()"
              class="w-8 h-8 rounded-full bg-[#D2D2D2] flex items-center justify-center hover:bg-[#E0E0E0] transition cursor-pointer"
            >
              <img src="/pages/history/cross.svg" alt="close" class="w-4 h-4" />
            </button>
          </div>
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-[20px] font-semibold text-[#2E4200]">Pick Periode</h3>
          </div>

          <div class="h-[1.12px] bg-[#D2D2D2] w-full mb-6"></div>

          <div class="flex justify-center gap-12 h-50 relative">
            <div
              id="monthContainer"
              (scroll)="onScrollMonth($event)"
              class="h-full overflow-y-auto scrollbar-hide text-center snap-y snap-mandatory z-10 w-30"
            >
              <div class="h-20"></div>

              <div
                *ngFor="let m of monthsList; let i = index"
                class="h-10 flex items-center justify-center cursor-pointer transition-all duration-200 snap-center"
                (click)="tempMonthIndex = i; scrollToActive()"
                [class.text-[20px]]="i === tempMonthIndex"
                [class.font-bold]="i === tempMonthIndex"
                [class.text-black]="i === tempMonthIndex"
                [class.text-[#A0A0A0]]="i !== tempMonthIndex"
                [class.text-[16px]]="i !== tempMonthIndex"
                [class.scale-110]="i === tempMonthIndex"
              >
                {{ m }}
              </div>

              <div class="h-20"></div>
            </div>

            <div
              id="yearContainer"
              (scroll)="onScrollYear($event)"
              class="h-full overflow-y-auto scrollbar-hide text-center snap-y snap-mandatory z-10 w-20"
            >
              <div class="h-20"></div>

              <div
                *ngFor="let y of yearsList"
                class="h-10 flex items-center justify-center cursor-pointer transition-all duration-200 snap-center"
                (click)="tempYear = y; scrollToActive()"
                [class.text-[20px]]="y === tempYear"
                [class.font-bold]="y === tempYear"
                [class.text-black]="y === tempYear"
                [class.text-[#A0A0A0]]="y !== tempYear"
                [class.text-[16px]]="y !== tempYear"
                [class.scale-110]="y === tempYear"
              >
                {{ y }}
              </div>

              <div class="h-20"></div>
            </div>

            <div
              class="absolute inset-0 pointer-events-none bg-linear-to-b from-[#F4F4F4] via-transparent to-[#F4F4F4] z-20"
            ></div>
          </div>

          <div class="mt-8">
            <button
              (click)="applyPeriodSelection()"
              class="w-full bg-[#AFFA01] hover:bg-[#9de300] text-black font-medium py-3 rounded-[6.72px] transition shadow-md active:scale-[0.98] cursor-pointer"
            >
              Search
            </button>
          </div>
        </div>
      </div>

      <div class="space-y-8">
        <div class="space-y-8">
          <div *ngFor="let group of activityGroups">
            <div class="flex items-center gap-3 justify-between mb-5">
              <h3 class="text-[20px] font-semibold text-[#808080]">{{ group.dateLabel }}</h3>
            </div>

            <div class="flex flex-col gap-5">
              <div
                *ngFor="let item of group.activities; let i = index"
                class="bg-[#F9F9F9] rounded-lg border border-[#E6E6E6] overflow-hidden transition-all duration-300"
              >
                <div class="p-6">
                  <div class="flex flex-col md:flex-row gap-6 mb-2">
                    <div
                      class="w-24 h-24 bg-[#BCE455] rounded-xl flex items-center justify-center shrink-0"
                    >
                      <img
                        src="/pages/icons/running-man.svg"
                        alt="icon"
                        class="w-12 h-12 text-black"
                      />
                    </div>

                    <div class="flex-1 flex flex-col">
                      <div class="flex justify-between items-start">
                        <div>
                          <h4 class="text-[18px] font-bold text-[#1F1F1F]">{{ item.title }}</h4>
                          <p class="text-[12px] text-[#757575] mt-1 leading-relaxed max-w-md">
                            {{ item.description }}
                          </p>
                        </div>

                        <div class="flex flex-col gap-2 shrink-0 ml-4 mt-4 md:mt-0">
                          <div
                            class="flex items-center gap-2 text-[12px] text-[#5C8C00] font-medium"
                          >
                            <div
                              class="w-5 h-5 bg-[#6A9700] flex items-center justify-center rounded-sm"
                            >
                              <img src="/pages/calendar/duration.svg" alt="" class="w-3 h-3" />
                            </div>
                            {{ item.time }}
                          </div>
                          <div
                            class="flex items-center gap-2 text-[12px] text-[#E10000] font-medium"
                          >
                            <div
                              class="w-5 h-5 bg-[#E10000] flex items-center justify-center rounded-sm"
                            >
                              <img
                                src="/pages/calendar/calories.svg"
                                class="w-3 h-3"
                                alt="calories"
                              />
                            </div>
                            {{ item.calories }}
                          </div>
                        </div>
                      </div>

                      <div class="mt-4">
                        <div
                          class="inline-flex items-center gap-1 bg-[#AFFA01] text-[#404040] text-[11px] font-medium px-4 py-1 rounded-full"
                        >
                          <img src="/pages/workout-lists/workout-run.svg" alt="" />{{ item.tag }}
                        </div>
                      </div>
                    </div>
                  </div>

                  <div
                    class="flex flex-col md:flex-row items-end justify-between gap-4 md:gap-6 mt-5"
                  >
                    <div class="w-full md:w-[55%]">
                      <div
                        class="flex items-center justify-between text-[12px] text-[#757575] mb-2 font-medium"
                      >
                        <span>Progress :</span> <span>{{ item.progress }}%</span>
                      </div>
                      <div class="w-full bg-[#E5E5E5] h-3 rounded-full overflow-hidden">
                        <div
                          class="bg-[#AFFA01] h-full rounded-full transition-all duration-500"
                          [style.width.%]="item.progress"
                        ></div>
                      </div>
                    </div>

                    <button
                      *ngIf="item.status == 'unfinished'"
                      class="w-full md:w-[38%] h-8.75 bg-[#EDE689] border border-[#A39200] text-[#876A00] font-medium rounded-full text-[13px]"
                    >
                      Unfinished
                    </button>

                    <button
                      *ngIf="item.status !== 'unfinished'"
                      class="w-full md:w-[38%] h-8.75 bg-[#AFFA01] border border-[#8AC500] text-[#4E7000] font-medium rounded-full text-[13px] flex items-center justify-center gap-2 shadow-sm"
                    >
                      Finished
                    </button>
                  </div>
                </div>

                <div class="bg-[#F2F2F2] border-t border-[#E6E6E6]">
                  <div
                    *ngIf="item.expanded"
                    class="px-6 py-6 animate-in slide-in-from-top-2 duration-200"
                  >
                    <div *ngIf="!item.logs || item.logs.length === 0" class="text-center py-2">
                      <p class="text-[#A0A0A0] text-[14px] italic font-light">Your Log is Empty!</p>
                    </div>

                    <div *ngIf="item.logs && item.logs.length > 0" class="space-y-4">
                      <div *ngFor="let log of item.logs" class="flex gap-3 items-stretch">
                        <div class="w-1.5 bg-[#6A9700] rounded-full shrink-0"></div>
                        <div
                          class="flex-1 bg-[#DBF3A3] border border-[#AFFA01] p-4 rounded-lg shadow-sm flex justify-between items-start"
                        >
                          <div>
                            <h5 class="text-[14px] font-bold text-[#1F1F1F]">{{ log.name }}</h5>
                            <p class="text-[12px] text-[#404040] mt-1 leading-relaxed">
                              {{ log.description }}
                            </p>
                          </div>
                          <div class="flex items-center gap-2 text-right shrink-0 ml-4">
                            <div
                              class="w-5 h-5 bg-[#6A9700] rounded-sm flex items-center justify-center"
                            >
                              <img src="/pages/calendar/duration.svg" alt="" class="w-3 h-3" />
                            </div>
                            <span class="text-[11px] font-medium text-[#4A6418]">{{
                              log.duration
                            }}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div *ngIf="item.expanded" class="h-px bg-[#D2D2D2] mx-6"></div>

                  <button
                    (click)="toggleExpand(item)"
                    class="w-full flex items-center justify-center gap-2 text-[#9E9E9E] text-[12px] font-medium py-3 hover:text-gray-600 transition group cursor-pointer"
                  >
                    <img
                      src="/pages/calendar/arrow-down.svg"
                      alt=""
                      class="transition-transform duration-300"
                      [class.rotate-180]="item.expanded"
                    />
                    {{ item.expanded ? 'Close All Log' : 'View All Log' }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="hidden lg:block space-y-8 mt-7">
      <app-calendar [selectedMode]="selectedMode"></app-calendar>
    </div>
  </div>
</div>

<div *ngIf="isLogModalOpen" class="fixed inset-0 z-50 flex items-center justify-center px-4"></div>
